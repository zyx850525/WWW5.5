# Cocreate Backend Architecture

## ğŸ“ æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Frontend (React)                      â”‚
â”‚                    (localhost:8080)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ HTTP/REST API
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Backend API Server                        â”‚
â”‚                  (Node.js + Express)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   REST API   â”‚  â”‚  IPFS Serviceâ”‚  â”‚ Event Listenerâ”‚      â”‚
â”‚  â”‚   Endpoints  â”‚  â”‚   (Pinata)   â”‚  â”‚  (ethers.js) â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                   â”‚                   â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚PostgreSQLâ”‚         â”‚  IPFS   â”‚        â”‚Blockchainâ”‚
    â”‚ Database â”‚         â”‚(Pinata) â”‚        â”‚  (Ethereum)â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ æ•°æ®æµ

### 1. å‰ç«¯æŸ¥è¯¢æ•°æ®
```
Frontend â†’ Backend API â†’ PostgreSQL â†’ Response
```
- å‰ç«¯è°ƒç”¨ REST API æŸ¥è¯¢é¡¹ç›®ã€ä»»åŠ¡ã€æˆå‘˜ç­‰
- åç«¯ä»æ•°æ®åº“å¿«é€Ÿè¿”å›ï¼ˆæ— éœ€æŸ¥è¯¢é“¾ä¸Šï¼‰

### 2. ç”¨æˆ·æ“ä½œï¼ˆå†™æ“ä½œï¼‰
```
Frontend â†’ User Wallet â†’ Smart Contract â†’ Blockchain
```
- ç”¨æˆ·é€šè¿‡é’±åŒ…ç›´æ¥è°ƒç”¨æ™ºèƒ½åˆçº¦
- åç«¯ä¸å‚ä¸ï¼ˆå»ä¸­å¿ƒåŒ–ï¼‰

### 3. äº‹ä»¶åŒæ­¥
```
Blockchain â†’ Event Listener â†’ PostgreSQL
```
- äº‹ä»¶ç›‘å¬å™¨æŒç»­ç›‘å¬é“¾ä¸Šäº‹ä»¶
- è‡ªåŠ¨åŒæ­¥åˆ°æ•°æ®åº“

### 4. IPFS ä¸Šä¼ 
```
Frontend â†’ Backend API â†’ Pinata IPFS â†’ CID â†’ Database
```
- å‰ç«¯ä¸Šä¼ æ–‡ä»¶åˆ°åç«¯
- åç«¯ä¸Šä¼ åˆ° Pinata IPFS
- è¿”å› CID å¹¶å­˜å‚¨åˆ°æ•°æ®åº“

## ğŸ“¡ API ç«¯ç‚¹

### é¡¹ç›®ç›¸å…³
- `GET /api/projects` - è·å–é¡¹ç›®åˆ—è¡¨
- `GET /api/projects/:projectId` - è·å–é¡¹ç›®è¯¦æƒ…
- `GET /api/projects/:projectId/stats` - è·å–é¡¹ç›®ç»Ÿè®¡
- `GET /api/users/:address/projects` - è·å–ç”¨æˆ·é¡¹ç›®

### æˆå‘˜ç›¸å…³
- `GET /api/projects/:projectId/members` - è·å–æˆå‘˜åˆ—è¡¨
- `GET /api/projects/:projectId/members/:address` - è·å–æˆå‘˜è¯¦æƒ…

### ä»»åŠ¡ç›¸å…³
- `GET /api/projects/:projectId/tasks` - è·å–ä»»åŠ¡åˆ—è¡¨
- `GET /api/tasks/:taskId` - è·å–ä»»åŠ¡è¯¦æƒ…
- `POST /api/tasks/:taskId/proof` - ä¸Šä¼ è¯æ˜æ–‡ä»¶

### IPFS ç›¸å…³
- `GET /api/ipfs/:cid` - è·å– IPFS æ–‡ä»¶å…ƒæ•°æ®

### äº‹ä»¶ç›¸å…³
- `GET /api/projects/:projectId/events` - è·å–é¡¹ç›®äº‹ä»¶
- `GET /api/events/recent` - è·å–æœ€è¿‘äº‹ä»¶

### å¥åº·æ£€æŸ¥
- `GET /api/health` - å¥åº·æ£€æŸ¥
- `GET /api/status` - è¯¦ç»†çŠ¶æ€

## ğŸ—„ï¸ æ•°æ®åº“ Schema

### æ ¸å¿ƒè¡¨

1. **projects** - é¡¹ç›®ä¿¡æ¯
   - `project_id` (BigInt, PK) - é“¾ä¸Šé¡¹ç›® ID
   - `owner_address` - é¡¹ç›®æ‰€æœ‰è€…
   - `name`, `description` - é¡¹ç›®ä¿¡æ¯
   - `stake_amount` - è´¨æŠ¼é‡‘é¢
   - `status` - é¡¹ç›®çŠ¶æ€

2. **project_members** - æˆå‘˜ä¿¡æ¯
   - `project_id` + `member_address` (å¤åˆä¸»é”®)
   - `staked_amount` - è´¨æŠ¼é‡‘é¢
   - `status` - æˆå‘˜çŠ¶æ€
   - `tasks_completed`, `tasks_rejected` - ç»Ÿè®¡

3. **tasks** - ä»»åŠ¡ä¿¡æ¯
   - `task_id` (BigInt, PK) - é“¾ä¸Šä»»åŠ¡ ID
   - `project_id` - æ‰€å±é¡¹ç›®
   - `assignee_address` - è¢«æŒ‡æ´¾äºº
   - `proof_cid` - IPFS CID
   - `status` - ä»»åŠ¡çŠ¶æ€

4. **contribution_nfts** - NFT è®°å½•
   - `token_id` (BigInt, PK)
   - `project_id`, `task_id` - å…³è”
   - `contributor_address` - è´¡çŒ®è€…
   - `proof_cid` - è¯æ˜ CID

5. **blockchain_events** - äº‹ä»¶æ—¥å¿—
   - `transaction_hash` + `log_index` (å¤åˆä¸»é”®)
   - `event_name` - äº‹ä»¶åç§°
   - `event_data` (JSONB) - äº‹ä»¶æ•°æ®
   - `processed` - æ˜¯å¦å·²å¤„ç†

6. **ipfs_files** - IPFS æ–‡ä»¶ç¼“å­˜
   - `cid` (PK) - IPFS CID
   - `file_name`, `file_size`, `mime_type` - æ–‡ä»¶ä¿¡æ¯

## ğŸ”§ æ ¸å¿ƒæœåŠ¡

### 1. BlockchainService
- ä½¿ç”¨ ethers.js è¿æ¥åŒºå—é“¾
- è¯»å–åˆçº¦çŠ¶æ€
- æä¾›åˆçº¦å®ä¾‹ç»™äº‹ä»¶ç›‘å¬å™¨

### 2. IpfsService
- ä½¿ç”¨ Pinata API ä¸Šä¼ æ–‡ä»¶
- è¿”å› IPFS CID
- ç¼“å­˜æ–‡ä»¶å…ƒæ•°æ®

### 3. EventListenerService
- æŒç»­ç›‘å¬é“¾ä¸Šäº‹ä»¶
- è§£æäº‹ä»¶å¹¶æ›´æ–°æ•°æ®åº“
- å¹‚ç­‰æ€§å¤„ç†ï¼ˆé˜²æ­¢é‡å¤ï¼‰

## ğŸš€ éƒ¨ç½²æ¶æ„

### å¼€å‘ç¯å¢ƒ
```
Backend (localhost:3000)
  â”œâ”€ API Server
  â””â”€ Event Listener (same process or separate)
```

### ç”Ÿäº§ç¯å¢ƒ
```
Backend Server (Railway/Render/Fly.io)
  â”œâ”€ API Server (port 3000)
  â””â”€ Event Listener (background job)

PostgreSQL (Supabase/Neon)
  â””â”€ Database

Pinata IPFS
  â””â”€ File Storage
```

## ğŸ” å®‰å…¨è€ƒè™‘

1. **CORS** - é™åˆ¶å‰ç«¯åŸŸå
2. **è¾“å…¥éªŒè¯** - express-validator
3. **é”™è¯¯å¤„ç†** - ä¸æš´éœ²å†…éƒ¨é”™è¯¯
4. **æ—¥å¿—** - Winston è®°å½•æ‰€æœ‰æ“ä½œ
5. **ç¯å¢ƒå˜é‡** - æ•æ„Ÿä¿¡æ¯ä¸æäº¤åˆ°ä»£ç 

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

1. **æ•°æ®åº“ç´¢å¼•** - æ‰€æœ‰æŸ¥è¯¢å­—æ®µéƒ½æœ‰ç´¢å¼•
2. **åˆ†é¡µ** - åˆ—è¡¨æ¥å£æ”¯æŒåˆ†é¡µ
3. **äº‹ä»¶æ‰¹å¤„ç†** - äº‹ä»¶ç›‘å¬å™¨æ‰¹é‡å¤„ç†
4. **è¿æ¥æ± ** - Prisma è‡ªåŠ¨ç®¡ç†è¿æ¥æ± 

## ğŸ§ª æµ‹è¯•ç­–ç•¥

1. **API æµ‹è¯•** - ä½¿ç”¨ curl/Postman
2. **æ•°æ®åº“æµ‹è¯•** - ä½¿ç”¨ Prisma Studio
3. **äº‹ä»¶æµ‹è¯•** - æ¨¡æ‹Ÿåˆçº¦äº‹ä»¶
4. **é›†æˆæµ‹è¯•** - ç«¯åˆ°ç«¯æµç¨‹æµ‹è¯•

